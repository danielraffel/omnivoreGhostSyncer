{{!< default}}

<main class="site-main">

<div class="page-title" style="text-align:center; margin-bottom:2rem;">
    <h1 style="margin:0;">Intriguing Stuff</h1>
</div>

<div class="post-feed gh-feed gh-canvas">
    {{#foreach posts}}                        
        <article class="post-card {{post_class}}" data-creation-date="{{date published_at format="MMMM DD, YYYY"}}">
            <header class="post-card-header gh-canvas">
                <div class="single-meta">
                    <span class="single-meta-item single-meta-date">
                        <time datetime="{{date format='YYYY-MM-DD'}}">
                            {{!-- {{date published_at format="MMM DD"}}  --}}
                        </time>
                        {{#primary_tag}}
                            <span class="single-meta-item single-meta-tag">
                                {{!-- Tag display is commented out --}}
                            </span>
                        {{/primary_tag}}
                    </span>
                </div>
                <a class="post-card-link" href="{{article.originalArticleUrl}}">
                    {{#if feature_image}}
                    <div class="post-card-image">
                        <!-- Image element -->
                    </div>
                    {{/if}}
                    <h2 class="post-card-title">{{title}}</h2>
                </a>
            </header>
            <a class="post-card-link" href="{{url}}">
                <section class="post-card-content">
                    <div class="single-content gh-content gh-canvas">
                        {{content}}
                    </div>
                </section>
            </a>
            </section>
        </article>
    {{/foreach}}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var posts = document.querySelectorAll('.post-card');
  var postsByDate = {};

  // Function to format date to "MMM DD"
  function formatDate(dateStr) {
    var date = new Date(dateStr);
    var options = { year: 'numeric', month: 'short', day: 'numeric' };
    return date.toLocaleDateString('en-US', options);
  }

  // Group posts by their creation date
  posts.forEach(function(post) {
    var date = formatDate(post.dataset.creationDate);
    if (!postsByDate[date]) {
      postsByDate[date] = [];
    }
    postsByDate[date].push(post);
  });

  // Sort the dates
  var dates = Object.keys(postsByDate).sort(function(a, b) {
    return new Date(b) - new Date(a);
  });

  // Clear the posts and append them grouped by date
  var feed = document.querySelector('.post-feed');
  feed.innerHTML = '';

  dates.forEach(function(date) {
    // Create the date header using the same structure as the post headers
    var dateHeader = document.createElement('header');
    dateHeader.className = 'post-card-header gh-canvas';
    var singleMeta = document.createElement('div');
    singleMeta.className = 'single-meta';
    var singleMetaItem = document.createElement('span');
    singleMetaItem.className = 'single-meta-item single-meta-date';
    var time = document.createElement('time');
    time.textContent = date;
    singleMetaItem.appendChild(time);
    singleMeta.appendChild(singleMetaItem);
    dateHeader.appendChild(singleMeta);
    feed.appendChild(dateHeader);

    // Append posts for this date
    postsByDate[date].forEach(function(post) {
      var linkItem = post.querySelector('.link-item');
      var originalUrl = linkItem.dataset.originalUrl;
      var titleElement = post.querySelector('.post-card-title');
      var contentLinks = post.querySelectorAll('.post-card-content a, .post-card-link');

      // Update the title's inner HTML to be a hyperlink with the original URL
      if (titleElement) {
        titleElement.innerHTML = '<a href="' + originalUrl + '" target="_blank">' + linkItem.dataset.title + '</a>';
      }

      // Update all content links to use the original URL
      contentLinks.forEach(function(contentLink) {
        contentLink.setAttribute('href', originalUrl);
      });

      feed.appendChild(post);
    });
  });

  // Add CSS styles for the post cards
  var style = document.createElement('style');
  style.type = 'text/css';
  style.innerHTML = `
    .post-feed .post-card {
      margin-bottom: 45px;
      margin-top: -20px;
    }
    .single-meta {
      margin-left: 2px; /* hack to align the date lolz */
    }
  `;
  document.head.appendChild(style);
});
</script>

</main>
